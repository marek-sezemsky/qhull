--- qhull-2011.1/CMakeLists.txt.orig	2011-05-19 03:53:36.000000000 +0200
+++ qhull-2011.1/CMakeLists.txt	2011-07-05 17:58:55.111627041 +0200
@@ -166,21 +166,23 @@
 
 string(REGEX MATCH "[^.]+" qhull_MAJOR "${qhull_VERSION}")
 if(CMAKE_BUILD_TYPE MATCHES "[dD]ebug")
-    set(qhull_CPP qhullcpp_d)
-    set(qhull_SHARED qhull_d${qhull_MAJOR})
+    set(qhull_CPP_SHARED qhullcpp_d)
+    set(qhull_CPP_STATIC qhullcppstatic_d)
+    set(qhull_SHARED qhull_d)
     set(qhull_STATIC qhullstatic_d)
     set(qhull_STATICP qhullstatic_pd)
 else()
-    set(qhull_CPP qhullcpp)
-    set(qhull_SHARED qhull${qhull_MAJOR})
+    set(qhull_CPP_SHARED qhullcpp)
+    set(qhull_CPP_STATIC qhullcppstatic)
+    set(qhull_SHARED qhull)
     set(qhull_STATIC qhullstatic)
     set(qhull_STATICP qhullstatic_p)
 endif()
 
 set(
     qhull_TARGETS 
-        ${qhull_CPP} ${qhull_SHARED} ${qhull_STATIC} ${qhull_STATICP} 
-        qhull rbox qconvex qdelaunay qvoronoi qhalf
+        ${qhull_CPP_SHARED} ${qhull_CPP_STATIC} ${qhull_SHARED} ${qhull_STATIC} ${qhull_STATICP}
+        qhullprog rbox qconvex qdelaunay qvoronoi qhalf
         user_eg user_eg2 user_eg3
 )
 
@@ -193,21 +195,18 @@
         src/libqhull/qhull-exports.def)
 set_target_properties(${qhull_SHARED} PROPERTIES
     COMPILE_DEFINITIONS "qh_QHpointer"
-    VERSION ${qhull_VERSION})
+    VERSION ${qhull_VERSION} SOVERSION ${qhull_MAJOR})
 
 if(UNIX)
     target_link_libraries(${qhull_SHARED} m)
-    if(APPLE)
-        set_target_properties(${qhull_SHARED} PROPERTIES 
-            INSTALL_NAME_DIR "${LIB_INSTALL_DIR}")
-    else()
-        set_target_properties(${qhull_SHARED} PROPERTIES 
-            INSTALL_RPATH "${LIB_INSTALL_DIR}"
-            INSTALL_RPATH_USE_LINK_PATH TRUE
-            BUILD_WITH_INSTALL_RPATH FALSE)
-    endif()
 endif(UNIX)
 
+add_library(${qhull_CPP_SHARED} SHARED ${libqhullcpp_SOURCES})
+set_target_properties(${qhull_CPP_SHARED} PROPERTIES
+    COMPILE_DEFINITIONS "qh_QHpointer"
+    VERSION ${qhull_VERSION} SOVERSION ${qhull_MAJOR})
+target_link_libraries(${qhull_CPP_SHARED} ${qhull_SHARED})
+
 # ---------------------------------------
 # Define static libraries qhullstatic and qhullstatic_p (qh_QHpointer)
 # ---------------------------------------
@@ -230,8 +229,8 @@
 # Define C++ static library qhullcpp (qh_QHpointer)
 # ---------------------------------------
 
-add_library(${qhull_CPP} STATIC ${libqhullcpp_SOURCES})
-set_target_properties(${qhull_CPP} PROPERTIES
+add_library(${qhull_CPP_STATIC} STATIC ${libqhullcpp_SOURCES})
+set_target_properties(${qhull_CPP_STATIC} PROPERTIES
     COMPILE_DEFINITIONS "qh_QHpointer"
     VERSION ${qhull_VERSION})
 
@@ -252,40 +251,27 @@
     set(user_eg_DEFINES qh_QHpointer)
 endif()
 
-add_executable(qhull ${qhull_SOURCES})
-target_link_libraries(qhull ${qhull_STATIC})
-set_target_properties(qhull PROPERTIES 
-    VERSION ${qhull_VERSION})
+add_executable(qhullprog ${qhull_SOURCES})
+target_link_libraries(qhullprog ${qhull_STATIC} m)
+set_target_properties(qhullprog PROPERTIES OUTPUT_NAME qhull)
 
 add_executable(rbox ${rbox_SOURCES})
-target_link_libraries(rbox ${qhull_STATIC})
-set_target_properties(rbox PROPERTIES
-    VERSION ${qhull_VERSION})
+target_link_libraries(rbox ${qhull_STATIC} m)
 
 add_executable(qconvex ${qconvex_SOURCES})
-target_link_libraries(qconvex ${qhull_STATIC})
-set_target_properties(qconvex PROPERTIES
-    VERSION ${qhull_VERSION})
+target_link_libraries(qconvex ${qhull_STATIC} m)
 
 add_executable(qdelaunay ${qdelaunay_SOURCES})
-target_link_libraries(qdelaunay ${qhull_STATIC})
-set_target_properties(qdelaunay PROPERTIES
-    VERSION ${qhull_VERSION})
+target_link_libraries(qdelaunay ${qhull_STATIC} m)
 
 add_executable(qvoronoi ${qvoronoi_SOURCES})
-target_link_libraries(qvoronoi ${qhull_STATIC})
-set_target_properties(qvoronoi PROPERTIES
-    VERSION ${qhull_VERSION})
+target_link_libraries(qvoronoi ${qhull_STATIC} m)
 
 add_executable(qhalf ${qhalf_SOURCES})
-target_link_libraries(qhalf ${qhull_STATIC})
-set_target_properties(qhalf PROPERTIES
-    VERSION ${qhull_VERSION})
+target_link_libraries(qhalf ${qhull_STATIC} m)
 
 add_executable(user_eg2 ${user_eg2_SOURCES})
-target_link_libraries(user_eg2 ${qhull_STATIC})
-set_target_properties(user_eg2 PROPERTIES
-    VERSION ${qhull_VERSION})
+target_link_libraries(user_eg2 ${qhull_STATIC} m)
 
 # ---------------------------------------
 # Define qhull executables linked to qhull shared library
@@ -297,8 +283,7 @@
 # user_eg may be linked to qhull_STATIC if user_eg_DEFINES is removed
 target_link_libraries(user_eg ${qhull_SHARED})
 set_target_properties(user_eg PROPERTIES
-    COMPILE_DEFINITIONS "${user_eg_DEFINES}"
-    VERSION ${qhull_VERSION})
+    COMPILE_DEFINITIONS "${user_eg_DEFINES}")
 
 # ---------------------------------------
 # Define qhull executables linked to qhullstatic_p and qhullcpp static library
@@ -312,10 +297,9 @@
 
 add_executable(user_eg3 ${user_eg3_SOURCES})
 # qhull_STATICP must be last, otherwise qh_fprintf,etc. are not loaded from qhull_CPP
-target_link_libraries(user_eg3 ${qhull_CPP} ${qhull_STATICP})
+target_link_libraries(user_eg3 ${qhull_CPP_SHARED} ${qhull_SHARED})
 set_target_properties(user_eg3 PROPERTIES
-    COMPILE_DEFINITIONS "qh_QHpointer"
-    VERSION ${qhull_VERSION})
+    COMPILE_DEFINITIONS "qh_QHpointer")
 
 # ---------------------------------------
 # Define install
